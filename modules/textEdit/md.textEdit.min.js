define(["jquery"],function(b,c,a){var d=b("jquery");(function(e){var f=function(h,g){this.$editGroup=e(h);this.options=e.extend({},f.DEFAULTS,g);this.inti()};f.DEFAULTS={active:false,url:"",isShowButton:true,onSuccess:null,onFail:null,onTimeout:null};f.prototype.inti=function(){this.$inputEdit=this.$editGroup.find(".input-editable");this.$btnEdit=this.$editGroup.find(".btn-edit");this.$groupSave=this.$editGroup.find(".group-save");this.$btnCancel=this.$groupSave.find(".btn-cancel");this.$btnSave=this.$groupSave.find(".btn-save");this.active=this.options.active;this.$btnEdit.on("click",e.proxy(this.allowEdit,this));this.$btnCancel.on("click",e.proxy(this.cancelEdit,this));this.$btnSave.on("click",e.proxy(this.saveEdit,this));var g=this;e("body").on("click.md",function(h){if(e.inArray(g.$editGroup.get(0),e(h.target).parents())===-1){g.cancelEdit()}})};f.prototype.getEditText=function(){var g=this.$inputEdit.val();this.extension=g.substring(g.lastIndexOf(".")+1);return this.editText=g.substring(0,g.lastIndexOf("."))};f.prototype.allowEdit=function(){this.getEditText();this.$inputEdit.addClass("focus").removeAttr("disabled").val(this.editText).focus();if(this.options.isShowButton){this.$btnEdit.parents(".group-edit").hide();this.$groupSave.show()}this.active=true;return this};f.prototype.cancelEdit=function(){if(!this.active){return}this.$groupSave.hide();this.$inputEdit.removeClass("focus").prop("disabled","disabled").val(this.editText+"."+this.extension);this.$btnEdit.parents(".group-edit").show();return this};f.prototype.saveEdit=function(){if(this.editText===this.$inputEdit.val()){this.cancelEdit();return}var g=this;e.ajax({url:this.options.url,data:{editName:this.$inputEdit.val()},global:false,success:function(h,i){if(h.trim()==="ok"){if(typeof g.options.onShow==="function"){g.options.onShow()}}else{g.cancelEdit();if(typeof g.options.onFail==="function"){g.options.onFail()}}},error:function(){g.cancelEdit();if(typeof g.options.onTimeout==="function"){g.options.onTimeout()}}})};e.fn.mdTextEdit=function(g){return this.each(function(){new f(this,g)})};e.fn.mdTextEdit.Constructor=f})(jQuery)});